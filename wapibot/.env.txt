# ============================================================================
# BACKEND V2 ENVIRONMENT VARIABLES
# ============================================================================

# Application
APP_NAME="WapiBot Backend V2"
APP_VERSION="2.0.0"
DEBUG=True
ENVIRONMENT="development"

# Server
HOST="0.0.0.0"
PORT=8000
RELOAD=True 

# Database (SQLite for checkpoints)
DATABASE_URL="sqlite+aiosqlite:///./conversations.db"
CHECKPOINT_DB_PATH="./checkpoints.db"

# ============================================================================
# LLM PROVIDERS - Choose one as PRIMARY_LLM_PROVIDER
# ============================================================================
PRIMARY_LLM_PROVIDER="ollama"  # Options: "ollama", "openrouter", "openai"

# LLM Provider - Ollama (Local, Free, No API key needed)
OLLAMA_BASE_URL="http://localhost:11434"
OLLAMA_MODEL="gemma3:4b"
OLLAMA_TIMEOUT=30.0
OLLAMA_MAX_RETRIES=2

# LLM Extraction Timeouts (in seconds)
# These are realistic for RTX 3060 - adjust for your hardware
EXTRACTION_TIMEOUT_NORMAL=90.0        # Normal extraction (10-90s typical)
EXTRACTION_TIMEOUT_COMPLEX=180.0      # Complex modules or first load
EXTRACTION_TIMEOUT_WARMUP=180.0       # Warmup queries (model loading time)

# LLM Provider - OpenRouter (Paid, supports 100+ models with failover)
OPENROUTER_API_KEY=""
OPENROUTER_BASE_URL="https://openrouter.ai/api/v1"
OPENROUTER_MODEL="openai/gpt-4o-mini"
OPENROUTER_FALLBACK_MODEL="anthropic/claude-3.5-haiku"
OPENROUTER_APP_NAME="WapiBot"
OPENROUTER_SITE_URL="https://github.com/yourusername/wapibot"
OPENROUTER_TIMEOUT=60.0

# LLM Provider - OpenAI (Paid, direct)
OPENAI_API_KEY=""
OPENAI_MODEL="gpt-4o-mini"
OPENAI_TIMEOUT=30.0

# DSPy Configuration
DSPY_CACHE_DIR="./dspy_cache"
DSPY_MAX_TOKENS=2000
DSPY_TEMPERATURE=0.4

# Confidence Score Thresholds
CONFIDENCE_LOW=0.5                    # Low confidence extraction
CONFIDENCE_MEDIUM=0.7                 # Medium confidence (regex fallback)
CONFIDENCE_HIGH=0.9                   # High confidence (DSPy extraction)

# Warmup Configuration
WARMUP_COOLDOWN_SECONDS=120           # Don't warmup again within 5 minutes (hot reload protection)
WARMUP_IDLE_THRESHOLD_SECONDS=60     # Trigger warmup after 5 minutes idle
WARMUP_IDLE_CHECK_INTERVAL=30         # Check idle status every minute

# LangGraph Configuration
LANGGRAPH_CHECKPOINT_ENABLED=True
LANGGRAPH_CHECKPOINT_PATH="./checkpoints.db"

# Workflow Selection (hot-swappable - no code changes needed!)
# Options: "existing_user_booking", "marketing_to_registration", "v2_full_workflow"
ACTIVE_WORKFLOW="existing_user_booking"

# WAPI (WhatsApp Business API)
WAPI_BASE_URL="https://wapi.in.net/api/"
WAPI_VENDOR_UID="cd4203ff-71c9-4872-8682-41e835f8a250"  # Your WAPI vendor UID
WAPI_BEARER_TOKEN="bmCmGnTiHdoMS4nlPut0Kf6UNXoNzOdyLwkVpA2w5b2Pbs1NTjhGlQv8oV8C8T3P"  # Your WAPI bearer token for API authentication
WAPI_FROM_PHONE_NUMBER_ID="963043230216783"  # Optional: Default phone number ID
WAPI_WEBHOOK_SECRET=""  # Optional: HMAC secret for webhook signature validation
WAPI_WEBHOOK_URL="https://inconsumable-jennie-peskily.ngrok-free.dev/api/v1/wapi/webhook"  # Current ngrok webhook URL (update when ngrok restarts)

# Frappe Backend
FRAPPE_BASE_URL="https://yawlit.duckdns.org"
FRAPPE_API_KEY="57ebe42fbfc0dd0"
FRAPPE_API_SECRET="e4325914d099b80"

# Public Base URL (for serving QR codes to WAPI)
# CRITICAL: Must be ngrok URL for WAPI to download media from external network
# NOT localhost - WAPI servers cannot reach localhost!
PUBLIC_BASE_URL="https://inconsumable-jennie-peskily.ngrok-free.dev"

# Yawlit Client
YAWLIT_BASE_URL="http://localhost:3000"
YAWLIT_API_KEY=""

# Frontend (NextJS Mock)
FRONTEND_URL="http://localhost:3000"
CORS_ORIGINS="http://localhost:3000,http://localhost:3001"

# Logging
LOG_LEVEL="INFO"
LOG_FORMAT="json"
LOG_FILE="./logs/backend.log"

# ============================================================
# SECURITY CONFIGURATION
# ============================================================

# Environment (affects auto-hardening behavior)
ENVIRONMENT=development  # production | staging | development

# JWT Authentication
JWT_SECRET_KEY=""  # Will be generated by setup script
JWT_ALGORITHM=HS256
JWT_EXPIRATION_MINUTES=60

# API Keys (Services) - Generated by setup script
API_KEY_ADMIN=""  # Admin + payments + brain access
API_KEY_BRAIN=""  # Brain-only access

# Rate Limiting (requests per second)
RATE_LIMIT_ENABLED=False  # Auto-enabled in production
RATE_LIMIT_CHAT=5
RATE_LIMIT_ADMIN=2
RATE_LIMIT_BRAIN=3
RATE_LIMIT_QR=8

# Field Encryption
FIELD_ENCRYPTION_KEY=""  # Will be generated by setup script

# Request/Response Encryption (optional)
REQUEST_ENCRYPTION_ENABLED=False

# Secret Management
SECRETS_ENCRYPTED=False  # Set to True after running setup script
MASTER_KEY_PATH=./master.key

# Legacy Settings (deprecated)
SECRET_KEY="your-secret-key-change-in-production"
ALLOWED_HOSTS="*"
RATE_LIMIT_PER_MINUTE=60

# Feature Flags
ENABLE_SENTIMENT_ANALYSIS=True
ENABLE_INTENT_CLASSIFICATION=True
ENABLE_BATCH_PROCESSING=True

# ============================================================================
# UPI PAYMENT CONFIGURATION
# ============================================================================

# UPI Payment
UPI_ID=7980866011@upi

# Bank Transfer Details
BANK_NAME="State Bank of India"
BANK_BRANCH="Kalikapur"
BANK_IFSC="SBIN0003907"
BANK_ACCOUNT_NO="39732237338"
BANK_ACCOUNT_NAME="YAWLIT AUTOMOTIVES PVT. LTD."

# Business Contact
COMPANY_NAME="Yawlit Automotives"
COMPANY_PHONE="N/A"
PAYMENT_HELP_TEXT="If you need any help making your payment, please contact us at your earliest convenience."

# Payment Reminder Configuration
PAYMENT_INSTANT_REMINDER=true
PAYMENT_REMINDER_INTERVALS=[24,48,72]
PAYMENT_CUTOFF_HOURS=168

# ============================================================================
# CELERY CONFIGURATION
# ============================================================================

CELERY_BROKER_URL=redis://localhost:6379/0
CELERY_RESULT_BACKEND=redis://localhost:6379/1

# ============================================================================
# WEBSOCKET
# ============================================================================
WEBSOCKET_ENABLED=True 
